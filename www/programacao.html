<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, target-densitydpi=medium-dpi, user-scalable=0" />
        <link rel="stylesheet" type="text/css" href="css/foundation.min.css" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <title>CineA</title>
    </head>
    <body>
        <header>
            <div class="row">
                <div class="small-12 small-text-center columns">
                    <a href="index.html" class="logo"><img src="img/cinea.png" /></a>
                </div>
            </div>
        </header>
        <div class="programming" style="margin-top: 180px;">
            <div class="title-full-width">
                <div class="row">
                    <div class="small-12 columns">
                        <h5><img src="img/bg-title-programming.jpg" />Programação</h5>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="small-12 columns text-center">
                    <h1 class="city-name">Cidade</h1>
                </div>
            </div>
            <div class="row image-loading">
                <div class="small-12 small-centered columns text-center">
                    <img src="img/image-loading.gif" style="width: 60px; margin-top: 80px;">
                </div>
            </div>
            <div class="row content-programming" style="display: none;">
                <ul class="tabs"><li class="tab-title active current-week">Semana</li></ul>
                <div class="tabs-content">
                    <div class="content active current-programming"></div>
                </div>
            </div>
        </div>
        <footer>
            <div class="row">
                <div class="small-12 columns">
                    <p><a href="index.html"><img src="img/home-icon.png" style="width: 55px;"></a></p>
                </div>
            </div>
        </footer>
    </body>
    <script src="js/zepto.min.js"></script>
    <script type="text/javascript">
        function GetUrlParameter(parameter) {
            var parameters = window.location.search.substring(1).split("&");
            for (var i = 0; i < parameters.length; i++) {
                var splitParameter = parameters[i].split("=");
                if (splitParameter[0] == parameter) {
                    return splitParameter[1];
                }
            }
        }
        var urlGetProgramming = "http://cinea.com.br/webapi/GetProgrammingByCity?cityId=" + GetUrlParameter("cityId");

        Zepto(function($){

            function FillHoraries(programming, divProgramming) {
                $.each(programming.Horaries, function (i, horary) {
                    var horaryNormal = horary.Horary != null ? '<p>' + horary.Horary + '</p>' : '';
                    var horaryWithObservation = '';

                    if (horary.HorariesWithObservation != null) {
                        $.each(horary.HorariesWithObservation, function (i, itemHoraryWithObservation) {
                            horaryWithObservation += '<p class="horary-with-observation">' + itemHoraryWithObservation + '</p>';
                        });
                    }

                    var is3D = horary.Is3D ? '<p class="type-image">3D</p>' : '';

                    var classClassification;
                    switch (horary.Classification) {
                        case "Livre":
                            classClassification = "classification-free";
                            break;
                        case "10 Anos":
                            classClassification = "classification-10";
                            break;
                        case "12 Anos":
                            classClassification = "classification-12";
                            break;
                        case "14 Anos":
                            classClassification = "classification-14";
                            break;
                        case "16 Anos":
                            classClassification = "classification-16";
                            break;
                        case "18 Anos":
                            classClassification = "classification-18";
                            break;
                    }

                    $(divProgramming).append('<div class="row-movie"><div class="small-12 columns name-and-horary"><h6><a href="#">' + horary.NameMovie + '</a></h6>' + horaryNormal + horaryWithObservation + '</div><div class="small-12 columns end informations text-left"><div class="row"><div class="small-4 columns">' + is3D + '</div><div class="small-4 columns"><p class="type-copy">' + horary.Idiom + '</p></div><div class="small-4 columns end"><p class="classification ' + classClassification +'"><span class="show-for-small-only">' + horary.Classification + '</span></p></div></div></div></div>');
                });
            }

            /*Get programming*/
            $.ajax({
                url: urlGetProgramming,
                type: "GET",
                success: function (programming) {
                    $(".city-name").html(programming.CityName);
                    $(".current-week").text(programming.Week);
                    FillHoraries(programming, '.current-programming');

                    $(".image-loading").hide();
                    $(".content-programming").show();
                }
            });

        });
    </script>
</html>
